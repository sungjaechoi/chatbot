# RAG 시스템 평가 결과 분석 보고서

## 1. 실험 개요

| 항목 | 값 |
|------|-----|
| 평가 일시 | 2026-01-30 |
| 테스트 케이스 | 20개 |
| PDF 문서 | 2개 (AI 역사 10p, 취업규칙 14p) |
| 실험 변수 | TopK (6 → 10) |

---

## 2. 결과 비교 요약

### 2.1 성공률 비교

| 항목 | TOP_K=6 | TOP_K=10 | 변화 |
|------|---------|----------|------|
| **전체 성공률** | 95% (19/20) | **100% (20/20)** | **+5%** |
| OK | 19건 | **20건** | +1 |
| RETRIEVAL_FAIL | 1건 | **0건** | **-1 (해결)** |
| GENERATION_FAIL | 0건 | 0건 | - |
| BOTH_FAIL | 0건 | 0건 | - |

### 2.2 품질 점수 비교

| 메트릭 | TOP_K=6 | TOP_K=10 | 변화 |
|--------|---------|----------|------|
| Correctness | 5.00 | 5.00 | - |
| Groundedness | 5.00 | 5.00 | - |
| Completeness | 4.80 | **4.85** | +0.05 |

### 2.3 Retrieval 메트릭 비교

| 메트릭 | TOP_K=6 | TOP_K=10 | 변화 |
|--------|---------|----------|------|
| Hit@K | 85% | 85% | - |
| Avg Best Rank | 2.76 | 3.18 | +0.42 |
| MRR | 0.494 | 0.463 | -0.031 |

> **참고**: MRR이 소폭 감소한 것은 더 많은 청크를 가져오면서 평균 순위가 분산된 결과이며, 실제 답변 품질은 향상됨

### 2.4 질문 타입별 성공률 비교

| 질문 타입 | TOP_K=6 | TOP_K=10 | 변화 |
|-----------|---------|----------|------|
| FACT (10건) | 100% | 100% | - |
| NOT_IN_DOC (4건) | 100% | 100% | - |
| INFERENCE (2건) | 100% | 100% | - |
| AMBIGUOUS (1건) | 100% | 100% | - |
| **COMPOSITE (3건)** | **66.7%** | **100%** | **+33.3%** |

---

## 3. 실패 케이스 해결 분석

### 3.1 실패 케이스 (TOP_K=6)

```
질문: "AI 역사에서 겨울(침체기)과 부흥기의 원인을 비교해주세요"
유형: COMPOSITE
판정: RETRIEVAL_FAIL
```

### 3.2 TOP_K=6에서의 검색 결과

| Rank | 페이지 | 내용 | Score |
|------|--------|------|-------|
| 1 | 9장 | 생성 인공지능의 시대 | 0.738 |
| 2 | 1장 | 인공지능의 탄생 | 0.727 |
| 3 | 10장 | 인공지능의 미래와 도전 | 0.719 |
| 4 | 8장 | 강화 학습과 게임 인공지능 | 0.695 |
| 5 | 5장 | 확률적 방법론의 발전 | 0.685 |
| 6 | 6장 | 딥러닝 혁명 | 0.657 |
| ❌ | **4장** | **기계 학습의 등장 (AI 겨울 정보 포함)** | **미포함** |

### 3.3 TOP_K=10에서의 개선

TOP_K=10으로 증가하면서 **4장이 검색 결과에 포함**되어 AI 겨울에 대한 정보를 LLM이 활용할 수 있게 됨:

```
"1990년대에 들어서면서 인공지능은 두 번째 겨울을 경험했다.
전문가 시스템의 유지보수 비용이 예상보다 높았고,
일본의 5세대 프로젝트도 목표를 달성하지 못했다."
```

### 3.4 해결 요인

| 요인 | 설명 |
|------|------|
| **더 많은 컨텍스트** | 10개 청크 → 문서의 100% 커버리지 (10p 문서) |
| **COMPOSITE 질문 지원** | 비교 질문에 필요한 여러 섹션 정보 확보 |
| **정보 누락 방지** | 제목과 질문 키워드가 다른 청크도 포함 |

---

## 4. 핵심 발견사항

### 4.1 LLM 프롬프트는 문제가 아니었다

| 구분 | 진단 | 근거 |
|------|------|------|
| **Retrieval** | ⚠️ 개선 필요했음 | 4장 누락 → 해결됨 |
| **LLM/Generation** | ✅ 처음부터 양호 | Hallucination 0건 |

TOP_K=6에서도 LLM은 올바르게 동작:
- "겨울 정보는 문서에서 찾을 수 없습니다"라고 정직하게 답변
- Hallucination 없이 컨텍스트 기반으로만 응답

### 4.2 COMPOSITE 질문의 특성

COMPOSITE(비교/종합) 질문은 **여러 섹션의 정보를 동시에 필요**로 함:

```
"겨울 vs 부흥기"
→ 4장(겨울) + 6장(딥러닝 부흥) + 8장(강화학습) + 9장(생성AI) 필요
```

TopK가 작으면 일부 정보가 누락되어 불완전한 답변이 생성됨.

### 4.3 TopK 설정 가이드라인

| 문서 크기 | 권장 TopK | 커버리지 |
|-----------|-----------|----------|
| ~10 페이지 | 10 | 100% |
| ~20 페이지 | 10-15 | 50-75% |
| ~50 페이지 | 15-20 | 30-40% |

> **주의**: TopK가 너무 크면 토큰 비용 증가 및 관련 없는 정보 포함 가능

---

## 5. 설정 변경 내역

### 변경 전 (.env)
```env
TOP_K=6
```

### 변경 후 (.env)
```env
TOP_K=10
```

---

## 6. 결론

### 6.1 실험 결과 요약

```
┌─────────────────────────────────────────────────────────┐
│                    실험 결과 요약                        │
├─────────────────────────────────────────────────────────┤
│  변경 사항: TOP_K 6 → 10                                │
│                                                         │
│  성공률:    95% → 100%  (+5%)                           │
│  COMPOSITE: 66.7% → 100%  (+33.3%)                      │
│                                                         │
│  LLM 프롬프트 수정: 불필요                               │
│  Retrieval 개선만으로 문제 해결                          │
└─────────────────────────────────────────────────────────┘
```

### 6.2 핵심 교훈

1. **RAG 실패 시 Retrieval을 먼저 의심하라**
   - LLM이 Hallucination 없이 "모른다"고 답하면 Retrieval 문제
   - LLM이 잘못된 정보를 생성하면 Generation 문제

2. **COMPOSITE 질문은 더 많은 컨텍스트가 필요**
   - 비교/종합 질문은 여러 섹션의 정보를 동시에 요구
   - TopK를 충분히 크게 설정

3. **문서 크기에 맞는 TopK 설정**
   - 작은 문서(~10p): TopK=10으로 전체 커버
   - 큰 문서: 다른 전략 필요 (Query Expansion, Hybrid Search)

### 6.3 추가 개선 가능 영역 (선택사항)

| 개선안 | 우선순위 | 현재 상태 |
|--------|---------|----------|
| TopK 동적 조정 | 낮음 | 현재 고정값으로 충분 |
| Query Expansion | 낮음 | 현재 불필요 |
| Hybrid Search | 낮음 | 현재 불필요 |
| 프롬프트 수정 | **불필요** | LLM 잘 동작 중 |

---

## 7. 첨부: 상세 결과

### 7.1 TOP_K=6 결과 파일
`scripts/evaluation-results.json`

### 7.2 TOP_K=10 결과 파일
`scripts/evaluation-results-topk10.json`

---

*보고서 작성일: 2026-01-30*
*최종 수정일: 2026-01-30*
