# ìµœì¢… ê²°ê³¼ ë³´ê³ : 20260210-ì„¸ì…˜ì—ëŸ¬-ì‚¬ì´ë“œë°”ìˆ˜ì •

## ê²°ê³¼ ìš”ì•½

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì‘ì—… ID** | 20260210-ì„¸ì…˜ì—ëŸ¬-ì‚¬ì´ë“œë°”ìˆ˜ì • |
| **ì‹œì‘ ì¼ì‹œ** | 2026-02-10 17:00 |
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-10 18:00 |
| **ìµœì¢… ìƒíƒœ** | âœ… PASS |
| **ì´ ì¬ì‘ì—… íšŸìˆ˜** | 2íšŒ |

## ì™„ë£Œ ì¡°ê±´ ì¶©ì¡± ì—¬ë¶€

| ì¡°ê±´ | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| ì„¸ì…˜ ìƒì„± API í˜¸ì¶œ ì‹œ ì„œë²„ ì—ëŸ¬ ì—†ì´ ì •ìƒ ì‘ë‹µ | âœ… ì¶©ì¡± | Try-Catch Fallback íŒ¨í„´ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì „/í›„ ëª¨ë‘ ì •ìƒ ë™ì‘ |
| ì„¸ì…˜ ëª©ë¡ ì¡°íšŒ API ì •ìƒ ë™ì‘ | âœ… ì¶©ì¡± | getSessionsByPdfIdì— fallback ì ìš©, title/last_message_at ê¸°ë³¸ê°’ ë³´ì¶© |
| ì‚¬ì´ë“œë°”ê°€ ë©”ì¸ í—¤ë” ì•„ë˜ì— ìœ„ì¹˜ | âœ… ì¶©ì¡± | ChatLayoutì—ì„œ í—¤ë”(ì „ì²´ ë„ˆë¹„) â†’ ì‚¬ì´ë“œë°”+ì±„íŒ… ì˜ì—­ flex-col êµ¬ì¡°ë¡œ ë³€ê²½ |
| ì‚¬ì´ë“œë°” ìì²´ ë¡œê³ /í—¤ë”ê°€ ì œê±°ë¨ | âœ… ì¶©ì¡± | ChatSidebarì—ì„œ Document Chat ì•„ì´ì½˜+í…ìŠ¤íŠ¸ í—¤ë” ì˜ì—­ ì™„ì „ ì œê±° |
| ë°ìŠ¤í¬íƒ‘/ëª¨ë°”ì¼ ëª¨ë‘ ë ˆì´ì•„ì›ƒ ì •ìƒ | âœ… ì¶©ì¡± | ëª¨ë°”ì¼ overlayë¥¼ absolute í¬ì§€ì…”ë‹ìœ¼ë¡œ ë³€ê²½, í•˜ë“œì½”ë”© ì œê±° |
| npm run build í†µê³¼ | âœ… ì¶©ì¡± | Compiled successfully in 1575ms |

## ìƒì„±/ìˆ˜ì •ëœ íŒŒì¼

### Backend

| íŒŒì¼ ê²½ë¡œ | ë³€ê²½ ìœ í˜• | ì„¤ëª… |
|-----------|-----------|------|
| src/shared/lib/supabase/chat-service.ts | modified | Try-Catch Fallback íŒ¨í„´ ì ìš© - getSessionsByPdfId, createSessionì€ 1ì°¨ ì‹œë„(title/last_message_at í¬í•¨) ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ì»¬ëŸ¼ë§Œ ì¡°íšŒ/ì‚½ì…, updateSessionTitleÂ·updateSessionLastMessageAtì€ column ì—ëŸ¬ ì‹œ silent fail |
| src/app/api/chat/sessions/route.ts | modified | ì„¸ì…˜ ëª©ë¡ ë§¤í•‘ì— nullish coalescing ì ìš© (title ?? null, last_message_at ?? created_at) |

### Frontend

| íŒŒì¼ ê²½ë¡œ | ë³€ê²½ ìœ í˜• | ì„¤ëª… |
|-----------|-----------|------|
| src/features/chat/ChatLayout.tsx | modified | flex-col êµ¬ì¡°ë¡œ ë³€ê²½: í—¤ë”(ì „ì²´ ë„ˆë¹„, ì‚¬ì´ë“œë°”í† ê¸€+ë¡œê³ +í¬ë ˆë”§+ìƒˆì„¸ì…˜) â†’ ì‚¬ì´ë“œë°”+ì±„íŒ… ì˜ì—­. ëª¨ë°”ì¼ overlayë¥¼ absolute í¬ì§€ì…”ë‹ìœ¼ë¡œ ë³€ê²½(top í•˜ë“œì½”ë”© ì œê±°) |
| src/features/chat/ChatSidebar.tsx | modified | ìì²´ ë¡œê³ /í—¤ë” ì˜ì—­(Document Chat ì•„ì´ì½˜+í…ìŠ¤íŠ¸) ì œê±°, ëª¨ë°”ì¼ ë‹«ê¸° ë²„íŠ¼ë§Œ ìœ ì§€ |
| src/features/chat/ChatView.tsx | modified | í—¤ë” ì™„ì „ ì œê±°(ChatLayoutìœ¼ë¡œ ì´ë™), h-screen â†’ h-full, props ë‹¨ìˆœí™”(pdfFileName/onNewSession/onToggleSidebar ì œê±°) |

## ì£¼ìš” ë³€ê²½ ì‚¬í•­

### 1. DB ë§ˆì´ê·¸ë ˆì´ì…˜ í˜¸í™˜ì„±: Try-Catch Fallback íŒ¨í„´

ê¸°ì¡´ ë¬¸ì œ: DBì— `title`/`last_message_at` ì»¬ëŸ¼ì´ ì—†ì„ ë•Œ `Could not find the 'title' column of 'chat_sessions' in the schema cache` ì—ëŸ¬ ë°œìƒ.

í•´ê²° ë°©ì‹:
- **getSessionsByPdfId**: 1ì°¨ ì‹œë„ì—ì„œ `title, last_message_at` í¬í•¨ ì¡°íšŒ â†’ ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ì»¬ëŸ¼ë§Œ ì¡°íšŒ í›„ `title: null`, `last_message_at: created_at`ìœ¼ë¡œ ê¸°ë³¸ê°’ ë³´ì¶©
- **createSession**: 1ì°¨ ì‹œë„ì—ì„œ `title` í¬í•¨ insert â†’ ì‹¤íŒ¨ ì‹œ title ì—†ì´ insert
- **updateSessionTitle / updateSessionLastMessageAt**: ì‹¤í–‰ í›„ ì—ëŸ¬ê°€ 'column' ê´€ë ¨ì´ë©´ silent fail (ë§ˆì´ê·¸ë ˆì´ì…˜ ë¯¸ì ìš© ìƒíƒœì—ì„œ ê¸°ëŠ¥ ì €í•˜ë§Œ ë°œìƒ, í¬ë˜ì‹œ ë°©ì§€)

ì´ íŒ¨í„´ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš© ì „/í›„ ëª¨ë‘ ì •ìƒ ë™ì‘í•©ë‹ˆë‹¤.

### 2. ë ˆì´ì•„ì›ƒ ì¬êµ¬ì„±: í—¤ë” â†’ ì‚¬ì´ë“œë°”+ì±„íŒ… êµ¬ì¡°

ê¸°ì¡´ êµ¬ì¡°: ì‚¬ì´ë“œë°”ì™€ ì±„íŒ… ë·°ê°€ ë‚˜ë€íˆ(flex-row), ê°ê° ìì²´ í—¤ë” ë³´ìœ 
ë³€ê²½ êµ¬ì¡°:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header (ì „ì²´ ë„ˆë¹„)               â”‚
â”‚ [â‰¡] [ğŸ“– Document Chat $0.50]   â”‚
â”‚                     [ìƒˆ ì„¸ì…˜]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Sidebar  â”‚ Chat Area            â”‚
â”‚ (280px)  â”‚ (flex-1)             â”‚
â”‚          â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- ChatViewì—ì„œ í—¤ë”ë¥¼ ì™„ì „íˆ ì œê±°í•˜ê³  ChatLayout ìƒë‹¨ìœ¼ë¡œ ì´ë™
- ì‚¬ì´ë“œë°” í† ê¸€, ë¡œê³ , í¬ë ˆë”§, PDF íŒŒì¼ëª…, ìƒˆ ì„¸ì…˜ ë²„íŠ¼ ëª¨ë‘ ChatLayout í—¤ë”ì— í†µí•©

### 3. ëª¨ë°”ì¼ Overlay í¬ì§€ì…”ë‹ ê°œì„ 

- ê¸°ì¡´: `position: fixed` + `top: '73px'` í•˜ë“œì½”ë”©
- ë³€ê²½: ì»¨í…Œì´ë„ˆì— `relative`, overlayì— `absolute inset-0` â†’ í—¤ë” ì•„ë˜ ì˜ì—­ ë‚´ì—ì„œ ìì—°ìŠ¤ëŸ½ê²Œ í‘œì‹œ
- í—¤ë” ë†’ì´ ë³€ê²½ì—ë„ ìë™ ëŒ€ì‘

## ë¯¸í•´ê²° ì‚¬í•­

- DB ë§ˆì´ê·¸ë ˆì´ì…˜ SQL ë¯¸ì‹¤í–‰ (ì‚¬ìš©ìê°€ Supabase ëŒ€ì‹œë³´ë“œì—ì„œ ì§ì ‘ ì‹¤í–‰ í•„ìš”)

### ë§ˆì´ê·¸ë ˆì´ì…˜ SQL

```sql
ALTER TABLE chat_sessions ADD COLUMN IF NOT EXISTS title TEXT;
ALTER TABLE chat_sessions ADD COLUMN IF NOT EXISTS last_message_at TIMESTAMPTZ DEFAULT now();
ALTER TABLE chat_sessions DROP CONSTRAINT IF EXISTS chat_sessions_user_id_pdf_id_key;
CREATE INDEX IF NOT EXISTS idx_chat_sessions_user_pdf ON chat_sessions(user_id, pdf_id);
```

## í›„ì† ì‘ì—… ê¶Œì¥

1. **DB ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰**: Supabase ëŒ€ì‹œë³´ë“œ SQL Editorì—ì„œ ìœ„ ë§ˆì´ê·¸ë ˆì´ì…˜ SQL ì‹¤í–‰ â†’ Try-Catch Fallback ì—†ì´ ì •ìƒ ë™ì‘
2. **íƒ€ì… ì¼ê´€ì„± ê°œì„ **: ChatSessionRowì˜ title/last_message_at í•„ë“œë¥¼ optional(?)ë¡œ ë³€ê²½í•˜ì—¬ íƒ€ì… ìˆ˜ì¤€ì—ì„œ ë§ˆì´ê·¸ë ˆì´ì…˜ ë¯¸ì ìš© ìƒíƒœ í‘œí˜„
3. **ëª¨ë°”ì¼ ì‚¬ì´ë“œë°” UX ê°œì„ **: ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜ë¡œ ì‚¬ì´ë“œë°” ì—´ê¸°/ë‹«ê¸° ì§€ì›

---
*ìƒì„±: Orchestrator | ì¼ì‹œ: 2026-02-10 18:00*
