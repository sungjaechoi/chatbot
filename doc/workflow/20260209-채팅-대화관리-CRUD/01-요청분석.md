# 요청 분석: 20260209-채팅-대화관리-CRUD

## 작업 개요

| 항목 | 내용 |
|------|------|
| **작업 ID** | 20260209-채팅-대화관리-CRUD |
| **분석 일시** | 2026-02-09 00:00 |
| **요청 요약** | PDF별 채팅에서 대화 내역 삭제(새 대화 시작) 기능을 추가합니다. 현재는 조회(Read)와 생성(Create)만 존재하며, Delete 기능이 없어 사용자가 이전 대화를 정리할 수 없습니다. |

## 요구사항

### 기능 요구사항

1. 채팅 대화 내역 삭제 API (DELETE /api/chat/history?pdfId=xxx)
2. 채팅 화면 헤더에 '새 대화' 버튼 추가 - 클릭 시 현재 세션의 메시지를 모두 삭제하고 빈 상태로 초기화
3. 삭제 전 확인 다이얼로그 표시
4. 삭제 중 로딩 상태 및 삭제 실패 시 에러 메시지 표시

### 비기능 요구사항

- 기존 디자인 시스템(Editorial Luxury 테마)과 일관된 UI
- 기존 코드 패턴(Container/View, Zustand, adminClient)과 일관된 구현

## 작업 범위

| 영역 | 작업 내용 |
|------|-----------|
| **Schema** | 해당 없음 (기존 스키마 활용) |
| **Backend** | chat-service.ts에 deleteMessages 함수 추가, DELETE /api/chat/history 엔드포인트 추가 |
| **Frontend** | chatStore에 clearHistory 액션 추가, ChatView 헤더에 '새 대화' 버튼 추가, ChatContainer에 핸들러 추가 |

## 완료 조건

- [ ] DELETE /api/chat/history?pdfId=xxx 호출 시 해당 세션의 메시지가 모두 삭제됨
- [ ] 인증되지 않은 요청에 401 반환
- [ ] 채팅 헤더에 '새 대화' 버튼이 표시되며 동작함
- [ ] 삭제 전 확인 다이얼로그 표시
- [ ] 삭제 후 채팅 화면이 빈 상태(EmptyState)로 초기화됨
- [ ] 에러 발생 시 사용자에게 적절한 메시지 표시

## 실행 계획

| 순서 | 에이전트 | 작업 내용 |
|------|----------|-----------|
| 1 | backend-developer | chat-service.ts에 deleteMessages 함수 추가 및 DELETE /api/chat/history 엔드포인트 구현 |
| 2 | frontend-developer | chatStore에 clearHistory 액션 추가, ChatView/ChatContainer에 '새 대화' 버튼 및 핸들러 구현 |
| 3 | reviewer | API 보안, 에러 처리, 코드 일관성, 통합 동작 검증 |

## 리스크 및 주의사항

- UNIQUE(user_id, pdf_id) 제약으로 세션 삭제 후 재생성 시 race condition 가능 - 메시지만 삭제 방식으로 회피
- adminClient 사용 시 인증 체크 누락 가능성
- 삭제 요청과 채팅 메시지 전송이 동시에 발생할 경우 데이터 정합성 이슈

---
*생성: Orchestrator | 일시: 2026-02-09 00:00*
