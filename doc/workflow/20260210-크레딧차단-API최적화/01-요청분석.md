# 요청 분석: 20260210-크레딧차단-API최적화

## 작업 개요

| 항목 | 내용 |
|------|------|
| **작업 ID** | 20260210-크레딧차단-API최적화 |
| **분석 일시** | 2026-02-10 00:00 |
| **요청 요약** | 크레딧 $0.2 이하 도달 시 모든 기능을 차단하는 오버레이 UI 구현 및 Supabase auth user API와 credits API의 과도한 호출 최적화 |

## 요구사항

### 기능 요구사항

1. 크레딧 잔액 $0.2 이하 시 전체 화면 차단 오버레이 표시
2. 차단 시 사이드 프로젝트 안내 문구 및 크레딧 소진 안내 표시
3. 테스트를 위한 크레딧 임계값 오버라이드 메커니즘 (localStorage 기반)
4. user API: 최초 로그인 이후와 회원정보 상실 시점에만 재요청
5. credits API: 임베딩과 LLM 모델 호출 후에만 재요청
6. 임베딩 완료 후 credits 갱신 추가

### 비기능 요구사항

- 기존 Editorial Luxury 디자인 시스템과의 일관성 유지
- API 호출 횟수 대폭 감소를 통한 성능 최적화

## 작업 범위

| 영역 | 작업 내용 |
|------|-----------|
| **Schema** | 해당 없음 |
| **Backend** | 해당 없음 |
| **Frontend** | creditsStore 상태 확장, useAuth 훅 최적화, useCredits 훅 최적화, CreditBlockOverlay 컴포넌트 신규 생성, ChatPageClient/HomeClient에 차단 로직 적용, PdfUploadContainer/ModalContainer에 임베딩 후 credits 갱신 추가 |

## 완료 조건

- [ ] 크레딧 잔액 $0.2 이하일 때 전체 화면 차단 오버레이가 표시된다
- [ ] 차단 오버레이에 RAG 사이드 프로젝트 안내 문구가 포함된다
- [ ] localStorage 기반 테스트 오버라이드가 정상 동작한다
- [ ] Supabase auth user API가 최초 로그인 1회 + onAuthStateChange 이벤트로만 호출된다
- [ ] credits API가 임베딩/LLM 호출 후에만 갱신된다 (컴포넌트 마운트 시 최초 1회 + 명시적 갱신)
- [ ] 기존 기능에 회귀 없음

## 실행 계획

| 순서 | 에이전트 | 작업 내용 |
|------|----------|-----------|
| 1 | frontend-developer | 크레딧 차단 UI + API 호출 최적화 구현 |
| 2 | reviewer | 코드 품질 검증 및 요구사항 충족 확인 |

## 리스크 및 주의사항

- useAuth 최적화 시 onAuthStateChange 이벤트만으로 user 상태가 정확히 갱신되지 않을 수 있음
- credits 최초 로딩 전 차단 판정이 불가능하여 잠깐 기능이 열릴 수 있음
- localStorage 기반 테스트 오버라이드가 프로덕션에서 악용될 수 있음 (단, 서버 측 검증은 별도 고려 필요)

---
*생성: Orchestrator | 일시: 2026-02-10 00:00*
