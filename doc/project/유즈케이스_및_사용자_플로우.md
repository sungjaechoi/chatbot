# PDF 기반 RAG 챗봇 - 유즈 케이스 및 사용자 플로우

## 1. 프로젝트 개요

본 시스템은 **PDF 문서 기반 RAG(Retrieval-Augmented Generation) 챗봇**으로, 사용자가 PDF 문서를 업로드하면 해당 문서의 내용을 학습하여 질문에 답변하는 AI 챗봇 서비스입니다.

### 핵심 가치
- 대용량 PDF 문서에서 원하는 정보를 빠르게 검색
- AI 기반 자연어 질의응답 제공
- 답변의 출처(페이지, 내용 스니펫) 명시로 신뢰성 확보

---

## 2. 유즈 케이스 (Use Cases)

### UC-01: PDF 문서 업로드

| 항목 | 내용 |
|------|------|
| **액터** | 사용자 |
| **설명** | 사용자가 분석할 PDF 문서를 시스템에 업로드한다 |
| **사전 조건** | 유효한 PDF 파일 (최대 10MB) |
| **기본 흐름** | 1. 사용자가 파일 선택 영역 클릭<br>2. PDF 파일 선택<br>3. "저장" 버튼 클릭<br>4. 시스템이 PDF 분석 및 임베딩 생성<br>5. 완료 후 채팅 화면으로 자동 이동 |
| **대안 흐름** | - 파일 형식 오류: "PDF 파일만 업로드 가능합니다" 메시지<br>- 파일 크기 초과: "10MB 이하 파일만 업로드 가능합니다" 메시지 |
| **사후 조건** | PDF가 벡터 DB에 저장되고 질의응답 가능 상태 |

### UC-02: PDF 문서 기반 질문

| 항목 | 내용 |
|------|------|
| **액터** | 사용자 |
| **설명** | 업로드한 PDF 문서 내용에 대해 질문하고 AI 답변을 받는다 |
| **사전 조건** | PDF 문서가 임베딩되어 저장된 상태 |
| **기본 흐름** | 1. 메시지 입력창에 질문 입력<br>2. Enter 키로 전송<br>3. AI가 관련 내용 검색 및 답변 생성<br>4. 답변과 참고 출처 표시 |
| **대안 흐름** | - 관련 내용 없음: "문서에서 관련 내용을 찾을 수 없습니다" 응답<br>- 네트워크 오류: 에러 메시지 표시 및 재시도 안내 |
| **사후 조건** | 대화 내역에 질문과 답변이 추가됨 |

### UC-03: 저장된 PDF 목록 조회 및 선택

| 항목 | 내용 |
|------|------|
| **액터** | 사용자 |
| **설명** | 이전에 업로드한 PDF 목록을 조회하고 원하는 문서를 선택한다 |
| **사전 조건** | 2개 이상의 PDF가 저장된 상태 |
| **기본 흐름** | 1. 메인 페이지에서 저장된 PDF 목록 확인<br>2. 원하는 PDF 클릭<br>3. 해당 PDF의 채팅 페이지로 이동 |
| **대안 흐름** | - PDF 1개만 존재: 자동으로 해당 PDF 선택<br>- PDF 0개: 업로드 화면 표시 |
| **사후 조건** | 선택한 PDF에 대한 질의응답 가능 |

### UC-04: PDF 문서 삭제

| 항목 | 내용 |
|------|------|
| **액터** | 사용자 |
| **설명** | 저장된 PDF 문서를 시스템에서 삭제한다 |
| **사전 조건** | 삭제할 PDF가 존재 |
| **기본 흐름** | 1. PDF 목록에서 삭제할 문서 확인<br>2. 삭제 버튼(휴지통 아이콘) 클릭<br>3. 시스템이 PDF 파일 및 벡터 데이터 삭제<br>4. 목록에서 제거됨 |
| **대안 흐름** | - 부분 삭제 실패: 에러 메시지 표시 |
| **사후 조건** | PDF 및 관련 임베딩 데이터가 삭제됨 |

### UC-05: 새 PDF로 전환 (채팅 중)

| 항목 | 내용 |
|------|------|
| **액터** | 사용자 |
| **설명** | 채팅 중 새로운 PDF를 업로드하여 대화 대상을 변경한다 |
| **사전 조건** | 현재 채팅 세션 진행 중 |
| **기본 흐름** | 1. "새로운 PDF" 버튼 클릭<br>2. 업로드 모달에서 새 PDF 선택<br>3. 업로드 및 분석 완료<br>4. 기존 대화 초기화, 새 PDF로 전환 |
| **대안 흐름** | - 업로드 취소: 기존 대화 유지 |
| **사후 조건** | 새 PDF에 대한 빈 대화창 표시 |

---

## 3. 유즈 케이스 다이어그램

```
                    ┌─────────────────────────────────────────┐
                    │           PDF RAG 챗봇 시스템            │
                    │                                         │
    ┌───────┐       │  ┌──────────────────────────────────┐  │
    │       │       │  │                                  │  │
    │       │───────┼──│  UC-01: PDF 문서 업로드           │  │
    │       │       │  │                                  │  │
    │       │       │  └──────────────────────────────────┘  │
    │       │       │                                         │
    │       │       │  ┌──────────────────────────────────┐  │
    │       │───────┼──│  UC-02: PDF 기반 질문             │  │
    │ 사용자 │       │  └──────────────────────────────────┘  │
    │       │       │                                         │
    │       │       │  ┌──────────────────────────────────┐  │
    │       │───────┼──│  UC-03: PDF 목록 조회/선택        │  │
    │       │       │  └──────────────────────────────────┘  │
    │       │       │                                         │
    │       │       │  ┌──────────────────────────────────┐  │
    │       │───────┼──│  UC-04: PDF 삭제                  │  │
    │       │       │  └──────────────────────────────────┘  │
    │       │       │                                         │
    │       │       │  ┌──────────────────────────────────┐  │
    │       │───────┼──│  UC-05: 새 PDF로 전환             │  │
    └───────┘       │  └──────────────────────────────────┘  │
                    │                                         │
                    └─────────────────────────────────────────┘
```

---

## 4. 사용자 플로우 (User Flow)

### 4.1 전체 사용자 여정 맵

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              사용자 여정 맵                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   [시작]                                                                    │
│      │                                                                      │
│      ▼                                                                      │
│   ┌──────────────┐                                                          │
│   │  메인 페이지  │                                                          │
│   │    (/)       │                                                          │
│   └──────┬───────┘                                                          │
│          │                                                                  │
│          ├──────────────────┬────────────────────┐                          │
│          │                  │                    │                          │
│          ▼                  ▼                    ▼                          │
│   ┌─────────────┐    ┌─────────────┐     ┌─────────────┐                    │
│   │ PDF 0개     │    │ PDF 1개     │     │ PDF 2개+    │                    │
│   │ 업로드 화면  │    │ 자동 선택   │     │ 목록 선택   │                    │
│   └──────┬──────┘    └──────┬──────┘     └──────┬──────┘                    │
│          │                  │                   │                          │
│          │                  │      ┌────────────┘                          │
│          │                  │      │                                       │
│          ▼                  │      ▼                                       │
│   ┌─────────────┐           │   ┌─────────────┐                             │
│   │ PDF 업로드   │           │   │ PDF 선택    │                             │
│   │ 및 분석     │           │   │ (클릭)      │                             │
│   └──────┬──────┘           │   └──────┬──────┘                             │
│          │                  │          │                                   │
│          └──────────────────┼──────────┘                                   │
│                             │                                              │
│                             ▼                                              │
│                    ┌─────────────────┐                                     │
│                    │   채팅 페이지    │                                     │
│                    │ (/chat/[pdfId]) │                                     │
│                    └────────┬────────┘                                     │
│                             │                                              │
│          ┌──────────────────┼──────────────────┐                           │
│          │                  │                  │                           │
│          ▼                  ▼                  ▼                           │
│   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                    │
│   │ 질문 입력   │    │ 새 PDF 업로드│    │ 홈으로 이동 │                    │
│   │ (Enter)     │    │ (모달)       │    │ (로고 클릭) │                    │
│   └──────┬──────┘    └──────┬──────┘    └──────┬──────┘                    │
│          │                  │                  │                           │
│          ▼                  │                  │                           │
│   ┌─────────────┐           │                  │                           │
│   │ AI 답변     │           │                  │                           │
│   │ + 출처 표시 │           │                  │                           │
│   └──────┬──────┘           │                  │                           │
│          │                  │                  │                           │
│          └──────────────────┼──────────────────┘                           │
│                             │                                              │
│                             ▼                                              │
│                         [계속...]                                          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.2 PDF 업로드 플로우

```
┌──────────────────────────────────────────────────────────────┐
│                    PDF 업로드 플로우                          │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│   [시작: 업로드 화면]                                         │
│          │                                                   │
│          ▼                                                   │
│   ┌─────────────────┐                                        │
│   │ 파일 선택 영역   │                                        │
│   │ 클릭/드래그     │                                        │
│   └────────┬────────┘                                        │
│            │                                                 │
│            ▼                                                 │
│   ┌─────────────────┐     ┌─────────────────┐               │
│   │ 파일 형식 확인  │──NO─▶│ 에러 메시지     │               │
│   │ (PDF?)         │     │ "PDF만 가능"    │               │
│   └────────┬────────┘     └─────────────────┘               │
│            │ YES                                             │
│            ▼                                                 │
│   ┌─────────────────┐     ┌─────────────────┐               │
│   │ 파일 크기 확인  │──NO─▶│ 에러 메시지     │               │
│   │ (≤10MB?)       │     │ "10MB 이하만"   │               │
│   └────────┬────────┘     └─────────────────┘               │
│            │ YES                                             │
│            ▼                                                 │
│   ┌─────────────────┐                                        │
│   │ "저장" 버튼     │                                        │
│   │ 클릭            │                                        │
│   └────────┬────────┘                                        │
│            │                                                 │
│            ▼                                                 │
│   ┌─────────────────┐                                        │
│   │ 로딩 상태       │                                        │
│   │ "PDF를 분석하고 │                                        │
│   │  있습니다..."   │                                        │
│   └────────┬────────┘                                        │
│            │                                                 │
│   ┌────────┴────────┐                                        │
│   │                 │                                        │
│   ▼                 ▼                                        │
│ [성공]           [실패]                                      │
│   │                 │                                        │
│   ▼                 ▼                                        │
│ ┌───────────┐  ┌───────────┐                                 │
│ │채팅 페이지│  │에러 메시지│                                 │
│ │ 자동 이동 │  │ 재시도    │                                 │
│ └───────────┘  └───────────┘                                 │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

### 4.3 채팅(질의응답) 플로우

```
┌──────────────────────────────────────────────────────────────┐
│                     채팅 플로우                               │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│   [시작: 채팅 페이지]                                         │
│          │                                                   │
│          ▼                                                   │
│   ┌─────────────────┐                                        │
│   │ 메시지 입력창   │                                        │
│   │ 에 질문 입력    │                                        │
│   └────────┬────────┘                                        │
│            │                                                 │
│   ┌────────┴────────┐                                        │
│   │                 │                                        │
│   ▼                 ▼                                        │
│ [Enter]        [Shift+Enter]                                 │
│   │                 │                                        │
│   ▼                 ▼                                        │
│ ┌───────────┐  ┌───────────┐                                 │
│ │ 메시지    │  │ 줄바꿈    │                                 │
│ │ 전송      │  │ 추가      │                                 │
│ └─────┬─────┘  └───────────┘                                 │
│       │                                                      │
│       ▼                                                      │
│ ┌───────────────────────────────────────┐                    │
│ │ 사용자 메시지가 채팅창에 표시 (파란색)  │                    │
│ └─────────────────┬─────────────────────┘                    │
│                   │                                          │
│                   ▼                                          │
│ ┌───────────────────────────────────────┐                    │
│ │ AI 응답 대기 중 (로딩 스피너)          │                    │
│ └─────────────────┬─────────────────────┘                    │
│                   │                                          │
│    ┌──────────────┴──────────────┐                           │
│    │                             │                           │
│    ▼                             ▼                           │
│ [성공]                        [실패]                         │
│    │                             │                           │
│    ▼                             ▼                           │
│ ┌─────────────────┐       ┌─────────────────┐               │
│ │ AI 답변 표시    │       │ 에러 메시지     │               │
│ │ (회색 배경)     │       │ "다시 시도"     │               │
│ └────────┬────────┘       └─────────────────┘               │
│          │                                                   │
│          ▼                                                   │
│ ┌─────────────────┐                                          │
│ │ 참고 출처 표시  │                                          │
│ │ • 페이지 번호   │                                          │
│ │ • 내용 스니펫   │                                          │
│ │ • 유사도 점수   │                                          │
│ └────────┬────────┘                                          │
│          │                                                   │
│          ▼                                                   │
│ ┌─────────────────┐                                          │
│ │ 자동 스크롤     │                                          │
│ │ (최신 메시지)   │                                          │
│ └─────────────────┘                                          │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

### 4.4 PDF 관리 플로우

```
┌──────────────────────────────────────────────────────────────┐
│                    PDF 관리 플로우                            │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│   [메인 페이지: PDF 목록]                                     │
│          │                                                   │
│          ▼                                                   │
│   ┌─────────────────────────────────────────┐               │
│   │ PDF 목록                                │               │
│   │ ┌─────────────────────────────────────┐ │               │
│   │ │ 📄 document1.pdf     [🗑️]          │ │               │
│   │ │ 📄 report2024.pdf    [🗑️]          │ │               │
│   │ │ 📄 manual.pdf        [🗑️]          │ │               │
│   │ └─────────────────────────────────────┘ │               │
│   └────────┬───────────────────────┬────────┘               │
│            │                       │                         │
│     [PDF 클릭]              [삭제 버튼 클릭]                  │
│            │                       │                         │
│            ▼                       ▼                         │
│   ┌─────────────────┐     ┌─────────────────┐               │
│   │ 해당 PDF의      │     │ PDF 삭제 처리   │               │
│   │ 채팅 페이지로   │     │                 │               │
│   │ 이동            │     │ • Chroma 컬렉션 │               │
│   └─────────────────┘     │ • 로컬 파일     │               │
│                           └────────┬────────┘               │
│                                    │                         │
│                           ┌────────┴────────┐               │
│                           │                 │               │
│                           ▼                 ▼               │
│                        [성공]            [실패]             │
│                           │                 │               │
│                           ▼                 ▼               │
│                    ┌───────────┐     ┌───────────┐          │
│                    │목록에서   │     │에러 메시지│          │
│                    │제거       │     │표시       │          │
│                    └───────────┘     └───────────┘          │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

---

## 5. 화면별 상세 플로우

### 5.1 메인 페이지 (/)

| 조건 | 화면 | 동작 |
|------|------|------|
| 저장된 PDF 0개 | `PdfUploadView` | PDF 업로드 화면 표시 |
| 저장된 PDF 1개 | - | 자동으로 `/chat/[pdfId]`로 리다이렉트 |
| 저장된 PDF 2개+ | `CollectionListView` | PDF 목록 선택 화면 표시 |

### 5.2 채팅 페이지 (/chat/[pdfId])

| 영역 | 컴포넌트 | 기능 |
|------|----------|------|
| 헤더 | - | 파일명 표시, "새로운 PDF" 버튼, 홈 링크 |
| 메시지 영역 | `MessageListView` | 대화 내역 표시 (사용자: 파란색, AI: 회색) |
| 입력 영역 | `MessageInputView` | 메시지 입력, Enter 전송 |
| 모달 | `PdfUploadModalContainer` | 새 PDF 업로드 |

### 5.3 메시지 표시 형식

**사용자 메시지:**
```
┌────────────────────────────────────┐
│                    파란색 배경     │
│                    사용자 질문 텍스트│
└────────────────────────────────────┘
```

**AI 응답 메시지:**
```
┌────────────────────────────────────┐
│ 회색 배경                          │
│ AI 답변 텍스트 (마크다운 렌더링)   │
├────────────────────────────────────┤
│ 📖 출처                            │
│ • 페이지 3 - "텍스트 스니펫..."    │
│ • 페이지 7 - "관련 내용..."        │
└────────────────────────────────────┘
```

---

## 6. 에러 처리 플로우

### 6.1 에러 코드 및 대응

| 에러 코드 | 상황 | 사용자 메시지 | 대응 |
|-----------|------|--------------|------|
| `NO_FILE` | 파일 미선택 | "파일을 선택해주세요" | 파일 선택 유도 |
| `INVALID_FILE_TYPE` | PDF가 아닌 파일 | "PDF 파일만 업로드 가능합니다" | PDF 파일 선택 유도 |
| `FILE_TOO_LARGE` | 10MB 초과 | "10MB 이하 파일만 업로드 가능합니다" | 작은 파일 선택 유도 |
| `UPLOAD_ERROR` | 업로드 실패 | "업로드 중 오류가 발생했습니다" | 재시도 |
| `EMBEDDING_ERROR` | 임베딩 실패 | "PDF 분석 중 오류가 발생했습니다" | 재시도 또는 다른 파일 시도 |
| `CHAT_ERROR` | 채팅 API 실패 | "응답을 생성하는 중 오류가 발생했습니다" | 재시도 |

### 6.2 에러 복구 플로우

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  에러 발생  │ ──▶ │ 에러 메시지 │ ──▶ │  재시도     │
│             │     │ 표시        │     │  또는 취소  │
└─────────────┘     └─────────────┘     └──────┬──────┘
                                               │
                              ┌────────────────┴────────────────┐
                              │                                 │
                              ▼                                 ▼
                       ┌─────────────┐                   ┌─────────────┐
                       │  재시도     │                   │  이전 상태  │
                       │  (동일 작업)│                   │  로 복귀    │
                       └─────────────┘                   └─────────────┘
```

---

## 7. 시스템 상태 다이어그램

```
┌─────────────────────────────────────────────────────────────────┐
│                        시스템 상태                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌──────────┐    업로드    ┌──────────┐   분석완료  ┌────────┐ │
│   │  초기    │ ──────────▶ │ 업로드중 │ ─────────▶ │ 준비   │ │
│   │  상태    │             │          │            │ 완료   │ │
│   └──────────┘             └────┬─────┘            └───┬────┘ │
│        ▲                        │                      │      │
│        │                        │ 실패                 │      │
│        │                        ▼                      ▼      │
│        │                   ┌──────────┐           ┌────────┐  │
│        └───────────────────│  에러    │           │ 채팅   │  │
│              재시도        │  상태    │           │ 활성   │  │
│                            └──────────┘           └───┬────┘  │
│                                                       │       │
│                                                       │ 삭제  │
│                                                       ▼       │
│                                                  ┌────────┐   │
│                                                  │ PDF    │   │
│                                                  │ 삭제됨 │   │
│                                                  └────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 8. 데이터 흐름 요약

### 8.1 PDF 업로드 시 데이터 흐름

```
사용자          프론트엔드         백엔드              외부 서비스
  │                │                 │                     │
  │ 파일 선택      │                 │                     │
  ├───────────────▶│                 │                     │
  │                │ POST /api/pdf/upload                  │
  │                ├────────────────▶│                     │
  │                │                 │ 파일 저장           │
  │                │                 │ (/tmp/uploads)      │
  │                │◀────────────────┤                     │
  │                │ {pdfId}         │                     │
  │                │                 │                     │
  │                │ POST /api/pdf/[pdfId]/save            │
  │                ├────────────────▶│                     │
  │                │                 │ PDF 텍스트 추출     │
  │                │                 │                     │
  │                │                 │ 임베딩 요청         │
  │                │                 ├────────────────────▶│
  │                │                 │◀────────────────────┤
  │                │                 │ 임베딩 벡터         │
  │                │                 │                     │
  │                │                 │ Chroma 저장         │
  │                │◀────────────────┤                     │
  │◀───────────────┤ 완료            │                     │
  │ 채팅 페이지    │                 │                     │
```

### 8.2 질문 응답 시 데이터 흐름

```
사용자          프론트엔드         백엔드              외부 서비스
  │                │                 │                     │
  │ 질문 입력      │                 │                     │
  ├───────────────▶│                 │                     │
  │                │ POST /api/chat  │                     │
  │                ├────────────────▶│                     │
  │                │                 │ 질문 임베딩 요청    │
  │                │                 ├────────────────────▶│
  │                │                 │◀────────────────────┤
  │                │                 │ 질문 벡터           │
  │                │                 │                     │
  │                │                 │ Chroma 유사도 검색  │
  │                │                 │                     │
  │                │                 │ LLM 요청 (컨텍스트) │
  │                │                 ├────────────────────▶│
  │                │                 │◀────────────────────┤
  │                │                 │ AI 답변             │
  │                │◀────────────────┤                     │
  │◀───────────────┤ 답변 + 출처     │                     │
  │                │                 │                     │
```

---

## 9. 비기능 요구사항

| 항목 | 요구사항 |
|------|----------|
| **파일 크기** | 최대 10MB PDF |
| **응답 시간** | 질문 응답 일반적으로 3-10초 |
| **동시성** | 단일 사용자 기준 설계 |
| **브라우저 지원** | 최신 Chrome, Firefox, Safari, Edge |
| **모바일 지원** | 반응형 UI 지원 |

---

## 10. 향후 확장 가능 유즈 케이스

| 유즈 케이스 | 설명 |
|-------------|------|
| 다중 PDF 동시 질의 | 여러 PDF를 선택하여 통합 검색 |
| 대화 내역 저장 | 채팅 기록 저장 및 불러오기 |
| PDF 하이라이트 | 답변 출처의 PDF 위치 하이라이트 표시 |
| 공유 기능 | 특정 대화를 링크로 공유 |
| 다국어 지원 | 영어, 일본어 등 다국어 PDF 지원 |

---

*본 문서는 PDF 기반 RAG 챗봇 시스템의 유즈 케이스 및 사용자 플로우를 정의합니다.*
